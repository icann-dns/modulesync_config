stages:
  - lint
  - unit

.ruby_job_template: &ruby_template
  tags:
  - linting
  cache:
    - key:
        files:
          - Gemfile
      paths:
        - vendor/bundle
        - Gemfile.lock
  before_script:
    - ruby -v
    - bundle --version
    - gem --version
    - bundle config set --local path 'vendor/bundle'
    - bundle install

lint:
  <<: *ruby_template
  stage: lint
  script:
    - bundle exec rake validate lint

rubocop:
  <<: *ruby_template
  stage: lint
  script:
    - bundle exec rake rubocop

rspec:
  <<: *ruby_template
  stage: unit
  script:
    - bundle exec rake spec
